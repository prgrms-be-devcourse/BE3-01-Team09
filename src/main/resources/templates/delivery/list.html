<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <link href="/globals.css" rel="stylesheet"/>
  <link href="/styleguide.css" rel="stylesheet"/>
  <link href="/delivery/list.css" rel="stylesheet"/>
  <title>배송지 관리</title>
</head>
<body>
<div class="PAGE">
  <div class="div">
    <div class="header">
      <div class="frame">
        <div class="logo">
          <a class="text-wrapper" href="/">Grids & Circles</a>
        </div>
        <div class="frame-2">
          <div class="div-wrapper">
            <a class="text-wrapper-2" href="/">Home</a>
          </div>
          <div class="header-2">
            <a class="text-wrapper-2"
               href="https://github.com/prgrms-be-devcourse/NBE3-01-Team09"
               target="_blank">Contact</a>
          </div>
          <div class="div-wrapper">
            <div class="text-wrapper-2">About</div>
          </div>
          <div class="header-3">
            <div class="text-wrapper-2">Sign Up</div>
          </div>
        </div>
      </div>
    </div>
    <div class="line"></div>
    <div class="roadmap">
      <div class="account">Home</div>
      <img class="line-2" src="https://c.animaapp.com/QemcTLqk/img/line-13.svg"/>
      <div class="nothing">My Account</div>
    </div>
    <div class="text-wrapper-3">내 정보 관리</div>
    <div class="frame-5">
      <a class="text-wrapper-5" th:href="@{/users/{id}(id=${id})}">내 정보</a>
      <a class="text-wrapper-6" href="#">배송지 관리</a>
    </div>
    <div class="text-wrapper-4">내 주문</div>
    <div class="frame-6">
      <a class="text-wrapper-7" th:href="@{/orders/{id}(id=${id})}">주문목록</a>
    </div>
    <div class="frame-8">
      <div class="group">
        <div class="delivery-box" th:each="address : ${list}">
          <div class="text-wrapper-8">배송지</div>
          <div class="frame-wrapper">
            <div class="frame-9">
              <div class="text-wrapper-9">받는 분 성함</div>
              <label class="placebox-info">
                <input class="text-wrapper-10" th:value="${address.name}" type="text" readonly>
              </label>
            </div>
            <div class="frame-9">
              <div class="text-wrapper-9">상세 주소</div>
              <label class="placebox-info">
                <input class="text-wrapper-10" th:value="${address.addressDetail}" type="text" readonly>
              </label>
            </div>
          </div>
          <div class="button-wrapper">
            <a class="button-edit" th:href="@{/deliveries/{id}/edit(id=${address.id})}">
              <label class="view-all-products">수정</label>
            </a>
            <button class="button-cancel" th:id="${address.id}">
              <label class="view-all-products">삭제</label>
            </button>
          </div>
        </div>
      </div>
      <div class="button-wrapper-2">
        <a class="button-add" th:href="@{/deliveries/{id}/create(id=${id})}">
          <label class="view-all-products">배송지 등록</label>
        </a>
      </div>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const deleteButtons = document.querySelectorAll('.button-cancel');

    deleteButtons.forEach(button => {
      button.addEventListener('click', function() {
        const addressId = this.getAttribute('id');

        // 삭제 확인 모달
        if (confirm('정말로 이 주소를 삭제하시겠습니까?')) {
          fetch(`/api/delivery/delete/${addressId}`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json'
            }
          })
                  .then(response => {
                    if (!response.ok) {
                      throw new Error('삭제 중 오류가 발생했습니다.');
                    }
                    return response.json();
                  })
                  .then(result => {
                    if (result) {
                      alert('주소가 성공적으로 삭제되었습니다.');
                      // 삭제 후 해당 주소 요소 제거
                      this.closest('.address-item').remove();
                    } else {
                      alert('삭제에 실패했습니다.');
                    }
                  })
                  .catch(error => {
                    console.error('Error:', error);
                    alert('삭제 중 문제가 발생했습니다.');
                  });
        }
      });
    });
  });</script>
</body>
</html>